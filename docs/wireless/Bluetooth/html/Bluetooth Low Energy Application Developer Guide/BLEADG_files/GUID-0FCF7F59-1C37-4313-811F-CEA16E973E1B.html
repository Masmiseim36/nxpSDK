<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en-us" lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2005"/>
<meta name="DC.rights.owner" content="(C) Copyright 2005"/>
<meta name="DC.Type" content="topic"/>
<meta name="DC.Title" content="Controller enhanced notifications"/>
<meta name="DC.Relation" scheme="URI" content="GUID-63657C9B-53F6-4C9C-BD21-827DE286933D.html"/>
<meta name="prodname" content="MC56F825x"/>
<meta name="version" content="1"/>
<meta name="release" content="0"/>
<meta name="modification" content="0"/>
<meta name="DC.Creator" content=""/>
<meta name="DC.Publisher" content="NXP Semiconductors"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-0FCF7F59-1C37-4313-811F-CEA16E973E1B"/>
<meta name="DC.Language" content="en-us"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Controller enhanced notifications</title>
</head>
<body id="GUID-0FCF7F59-1C37-4313-811F-CEA16E973E1B">


    <h1 class="title topictitle1">Controller enhanced notifications</h1>

    <div class="body">
        <p class="p">This chapter describes how the application can configure and monitor the
            notifications generated by the Bluetooth Controller when advertising, scan, or
            connection events occur. This feature is proprietary to NXP that is available on
            selected Controllers.</p>

        <div class="p">The user can choose between two options:<ol class="ol">
        <li class="li">Enable notifications from the GAP layer and monitor GAP events in the GAP
                    Generic Callback. The controller issues HCI vendor-specific events processed by
                    the Bluetooth LE Host and presented to the application in the GAP Generic
                    Callback.</li>

        <li class="li">Enable notifications from the Controller interface and monitor controller
                    events in a user-defined Application Callback.</li>

        <li class="li">Combination of the above two options: configure feature at GAP layer and
                    install an Application Callback through the Controller interface. After setting
                    the callback, the HCI vendor-specific events will not be issued and implicitly
                    the GAP events. Instead, the user receives the notifications in the installed
                    callback until setting the callback to NULL again if it wants to revert to GAP
                        events.<div class="note note"><span class="notetitle">Note:</span> The application callback does not run on ISR
                        context as current system architecture defines that the Link Layer
                        notifications are processed on the Controller task.</div>
</li>
</ol>

        <ul class="ul">
            <li class="li"><strong class="ph b">GAP configuration:</strong> <div class="p">The user should call the following function to enable various
                        events from the mask or use Event None to disable the feature. The Device ID
                        is valid only for connection
                        events.<pre class="pre codeblock">bleResult_t Gap_ControllerEnhancedNotification
(    uint16_t eventType,    
    deviceId_t deviceId
);</pre>
</div>
The
                    event type is a bitmask having the following options:
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="GUID-0FCF7F59-1C37-4313-811F-CEA16E973E1B__TABLE_SM3_XYS_LHB" class="table" frame="border" border="1" rules="all">
                            
                            
                            <thead class="thead" align="left">
                                <tr class="row">
                                    <th class="entry" valign="top" id="d1484e106"><strong class="ph b">Event Type</strong></th>

                                    <th class="entry" valign="top" id="d1484e110"><strong class="ph b">Event Description</strong></th>

                                </tr>

                            </thead>

                            <tbody class="tbody">
                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e106 ">gNotifEventNone_c</td>

                                    <td class="entry" valign="top" headers="d1484e110 ">No enhanced notification event enabled</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e106 ">gNotifConnEventOver_c</td>

                                    <td class="entry" valign="top" headers="d1484e110 ">Connection event over</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e106 ">gNotifConnRxPdu_c</td>

                                    <td class="entry" valign="top" headers="d1484e110 ">Connection RX PDU</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e106 ">gNotifAdvEventOver_c</td>

                                    <td class="entry" valign="top" headers="d1484e110 ">Advertising event over</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e106 ">gNotifAdvTx_c</td>

                                    <td class="entry" valign="top" headers="d1484e110 ">Advertising ADV transmitted</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e106 ">gNotifAdvScanReqRx_c</td>

                                    <td class="entry" valign="top" headers="d1484e110 ">Advertising SCAN REQ RX</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e106 ">gNotifAdvConnReqRx_c</td>

                                    <td class="entry" valign="top" headers="d1484e110 ">Advertising CONN REQ RX</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e106 ">gNotifScanEventOver_c</td>

                                    <td class="entry" valign="top" headers="d1484e110 ">Scanning event over</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e106 ">gNotifScanAdvPktRx_c</td>

                                    <td class="entry" valign="top" headers="d1484e110 ">Scanning ADV PKT RX</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e106 ">gNotifScanRspRx_c</td>

                                    <td class="entry" valign="top" headers="d1484e110 ">Scanning SCAN RSP RX</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e106 ">gNotifScanReqTx_c</td>

                                    <td class="entry" valign="top" headers="d1484e110 ">Scanning SCAN REQ TX</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e106 ">gNotifConnCreated_c</td>

                                    <td class="entry" valign="top" headers="d1484e110 ">Connection created</td>

                                </tr>

                            </tbody>

                        </table>
</div>
After enabling events, the user should wait for a
                    gControllerNotificationEvent_c GAP Generic Event in the GAP Generic Callback.
                    The first event received should have the event type set to gNotifEventNone_c
                    with a status of success confirming the selected event mask has been enabled.
                    The same event types apply for both the GAP command and the GAP event. The
                    structure for the Controller Notification event is the following: 
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="GUID-0FCF7F59-1C37-4313-811F-CEA16E973E1B__TABLE_GZ1_1ZS_LHB" class="table" frame="border" border="1" rules="all">
                            
                            
                            <thead class="thead" align="left">
                                <tr class="row">
                                    <th class="entry" valign="top" id="d1484e244"><strong class="ph b">Event Data</strong></th>

                                    <th class="entry" valign="top" id="d1484e248"><strong class="ph b">Data type</strong></th>

                                    <th class="entry" valign="top" id="d1484e252"><strong class="ph b">Data Description</strong></th>

                                </tr>

                            </thead>

                            <tbody class="tbody">
                              
                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e244 ">eventType</td>

                                    <td class="entry" valign="top" headers="d1484e248 ">bleNotificationEvent_t</td>

                                    <td class="entry" valign="top" headers="d1484e252 ">Enhanced notification event type</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e244 ">deviceId</td>

                                    <td class="entry" valign="top" headers="d1484e248 ">deviceId_t</td>

                                    <td class="entry" valign="top" headers="d1484e252 ">Device id of the peer, valid for connection
                                        events</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e244 ">rssi</td>

                                    <td class="entry" valign="top" headers="d1484e248 ">int8_t</td>

                                    <td class="entry" valign="top" headers="d1484e252 ">RSSI, valid for RX event types</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e244 ">channel</td>

                                    <td class="entry" valign="top" headers="d1484e248 ">uint8_t</td>

                                    <td class="entry" valign="top" headers="d1484e252 ">Channel, valid for connection event over or Rx/Tx
                                        events</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e244 ">ce_counter</td>

                                    <td class="entry" valign="top" headers="d1484e248 ">uint16_t</td>

                                    <td class="entry" valign="top" headers="d1484e252 ">Connection event counter, valid for connection events
                                        only</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e244 ">status</td>

                                    <td class="entry" valign="top" headers="d1484e248 ">bleResult_t</td>

                                    <td class="entry" valign="top" headers="d1484e252 ">Status of the request to select which events to be
                                        enabled/disabled</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" headers="d1484e244 ">timestamp</td>

                                    <td class="entry" valign="top" headers="d1484e248 ">uint16_t</td>

                                    <td class="entry" valign="top" headers="d1484e252 ">Timestamp in 625 us slots, valid for Conn RX
                                        event and Conn Created event</td>

                                </tr>

                            </tbody>

                        </table>
</div>
</li>

            <li class="li"><strong class="ph b">Controller configuration:</strong> <div class="p">The user should call the
                        following function to enable various events from the mask or use Event None
                        to disable the feature. The same event types apply as the GAP layer types.
                        The connection handle is valid only for connection events.
                        <pre class="pre codeblock">bleResult_t Controller_ConfigureEnhancedNotification
(    
    uint16_t eventType,    
    uint16_t conn_handle
);</pre>
The
                        event monitoring is done in a user installed callback by
                        calling:<pre class="pre codeblock">bleResult_t Controller_RegisterEnhancedEventCallback
( 
    bleCtrlNotificationCallback_t notificationCallback
);</pre>
Where
                        the types are the
                        following:<pre class="pre codeblock">typedef struct bleCtrlNotificationEvent_tag
{   uint16_t event_type; /*!bleNotificationEventType_t */    
    uint16_t conn_handle;    
    int8_t   rssi;    
    uint8_t  channel_index;    
    uint16_t conn_ev_counter;    
    uint16_t timestamp;
} bleCtrlNotificationEvent_t; 
typedef void (*bleCtrlNotificationCallback_t)
(     
    bleCtrlNotificationEvent_t    *pNotificationEvent
);</pre>
The
                        event structure is nearly identical as the GAP one, except there is no
                        status as the function call executes synchronously.
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="GUID-0FCF7F59-1C37-4313-811F-CEA16E973E1B__TABLE_ZTB_B1T_LHB" class="table" frame="border" border="1" rules="all">
                                
                                
                                
                                <thead class="thead" align="left">
                                    <tr class="row">
                                        <th class="entry" valign="top" id="d1484e377"><strong class="ph b">Event Data</strong></th>

                                        <th class="entry" valign="top" id="d1484e381"><strong class="ph b">Data type</strong></th>

                                        <th class="entry" valign="top" id="d1484e385"><strong class="ph b">Data Description</strong></th>

                                    </tr>

                                </thead>

                                <tbody class="tbody">
                                    <tr class="row">
                                        <td class="entry" valign="top" headers="d1484e377 ">event_type</td>

                                        <td class="entry" valign="top" headers="d1484e381 ">bleNotificationEvent_t</td>

                                        <td class="entry" valign="top" headers="d1484e385 ">Enhanced notification event type</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry" valign="top" headers="d1484e377 ">conn_handle</td>

                                        <td class="entry" valign="top" headers="d1484e381 ">uint16_t</td>

                                        <td class="entry" valign="top" headers="d1484e385 ">Connection handle of the peer, valid for
                                            connection events</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry" valign="top" headers="d1484e377 ">rssi</td>

                                        <td class="entry" valign="top" headers="d1484e381 ">int8_t</td>

                                        <td class="entry" valign="top" headers="d1484e385 ">RSSI, valid for RX event types</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry" valign="top" headers="d1484e377 ">channel_index</td>

                                        <td class="entry" valign="top" headers="d1484e381 ">uint8_t</td>

                                        <td class="entry" valign="top" headers="d1484e385 ">Channel, valid for connection event over
                                            or Rx/Tx events</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry" valign="top" headers="d1484e377 ">conn_ev_counter</td>

                                        <td class="entry" valign="top" headers="d1484e381 ">uint16_t</td>

                                        <td class="entry" valign="top" headers="d1484e385 ">Connection event counter, valid for
                                            connection events only</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry" valign="top" headers="d1484e377 ">timestamp</td>

                                        <td class="entry" valign="top" headers="d1484e381 ">uint16_t</td>

                                        <td class="entry" valign="top" headers="d1484e385 ">Timestamp in 625 us slots, valid for
                                            Conn RX event and Conn Created event </td>

                                    </tr>

                                </tbody>

                            </table>
</div>
</div>
</li>

        </ul>
</div>

    </div>

<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-63657C9B-53F6-4C9C-BD21-827DE286933D.html">Generic Access Profile (GAP) Layer</a></div>
</div>
</div>

</body>
</html>