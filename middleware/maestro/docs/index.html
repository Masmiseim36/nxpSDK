<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Maestro Audio Framework: Getting started with Maestro framework</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="fs_logo.gif"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Maestro Audio Framework
   &#160;<span id="projectnumber">v 1.0</span>
   </div>
   <div id="projectbrief">NXP Semiconductors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Getting started with Maestro framework </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_GettingStarted"></a> </p>
<h1><a class="anchor" id="autotoc_md1"></a>
Introduction</h1>
<p>This document describes basic usage of Maestro Audio Framework. The intent of this framework is to enable chaining of basic audio processing blocks (called "elements"). These blocks then form stream processing object ("pipeline"). This pipeline can be used for multiple audio processing use cases. The processing blocks can include (but are not limited to) different audio sources (for example file or microphone), decoders or encoders, filters or effects and audio sinks.</p>
<p>Framework overview is depicted on the following picture:</p>
<p><img src="maestro.svg" alt="" style="pointer-events: none;" class="inline" title="maestro overview"/></p>
<h1><a class="anchor" id="autotoc_md2"></a>
Supported examples</h1>
<ul>
<li>maestro_demo</li>
<li>maestro_usb_mic</li>
<li>maestro_usb_speaker</li>
</ul>
<p>The examples can be found in the audio_examples folder of the desired board. The demo applications are based on FreeRTOS and use multiple tasks to form application functionality.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Streamer setup</h1>
<p>In order to setup the audio framework properly, it is necessary to create a streamer with <code>streamer_create</code> api. It is also essential to setup the desired hardware peripherals using the functions described in <code><a class="el" href="streamer__pcm_8h.html" title="Streamer PCM API header.">streamer_pcm.h</a></code>. The Maestro example projects consist of several files with reference to audio framework. The initial file is <code>main.c</code> with code to create multiple tasks. For features including SD card (in the maestro_demo example, reading a file from SD card or writing to SD card is currently supported), the <code>APP_SDCARD_Task</code> is created. The command prompt and connected functionalities are handled by <code>APP_Shell_Task</code>. User commands are handled by functions in <code>cmd.c</code>. Five main commands are:</p>
<ul>
<li><b>version</b>: prints component version</li>
<li><b>file</b>: performs audio file decode and playback</li>
<li><b>record_mic</b>: records MIC audio and either:<ul>
<li><em>perform voice recognition (VIT)</em></li>
<li><em>playback on a codec</em></li>
<li><em>store samples to a file</em></li>
</ul>
</li>
<li><b>usb_mic</b>: record MIC audio and playback to USB port as an audio 2.0 microphone device</li>
<li><b>usb_speaker</b>: play data from USB port as an audio 2.0 speaker device</li>
</ul>
<p>One of the most important parts of the configuration is the <code>streamer_pcm.c</code> where can be found the initialization of the hardware peripherals, input and output buffer management. For further information please see also <code><a class="el" href="streamer__pcm_8h.html" title="Streamer PCM API header.">streamer_pcm.h</a></code></p>
<p>In the Maestro USB examples (maestro_usb_mic and maestro_usb_speaker), the USB configuration is located in the <code>usb_device_descriptor.c</code> and <code>audio_speaker.c</code> files. For further information please see also <code>usb_device_descriptor.h</code> and <code>audio_speaker.h</code>.</p>
<p>With creation of streamer object, the message thread is also created. The message thread is placed in <code>app_streamer.c</code> file, reads message queue and reacts on following messages:</p>
<ul>
<li>STREAM_MSG_ERROR</li>
<li>STREAM_MSG_EOS</li>
<li>STREAM_MSG_UPDATE_POSITION</li>
<li>STREAM_MSG_CLOSE_TASK</li>
</ul>
<p>The <code>STREAM_MSG_UPDATE_POSITION</code> prints info about current stream position, <code>STREAM_MSG_EOS</code> stops streamer, <code>STREAM_MSG_CLOSE_TASK</code> closes streamer thread and <code>STREAM_MSG_ERROR</code> stops streamer and closes thread.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Commands</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
file</h2>
<p>File command is only supported in the maestro_demo example. The command creates a streamer pipeline described in function <code>STREAMER_file_Create</code> in file <code>app_streamer.c</code>. The crucial part in this is defining pipeline type as <code>STREAM_PIPELINE_FILESYSTEM</code> or <code>STREAM_PIPELINE_EAP</code>. Depending on whether the <code>EAP_PROC</code> is defined and on the command option, that may be either <code>&lt;audio_file&gt;</code>, <code>all</code> or <code>eap</code>. This sets up the processing chain from file source to audio sink with decoder and potentially other processing in between. Playback itself is started in <code>STREAMER_Start</code> function. The elements that pipeline consists of are:</p>
<ul>
<li>TYPE_ELEMENT_FILE_SRC</li>
<li>TYPE_ELEMENT_DECODER</li>
<li>TYPE_ELEMENT_EAP (if <code>EAP_PROC</code> is defined and <code>eap</code> option is used)</li>
<li>TYPE_ELEMENT_AUDIO_SINK</li>
</ul>
<p>Other possible element types could be found in <code><a class="el" href="streamer__api_8h.html" title="Streamer API header.">streamer_api.h</a></code>.</p>
<p>Each of the elements have several properties that can be accessed using <code>streamer_get_property</code>. These properties allow user to change the values of the appropriate elements. The list of properties can be found in <code><a class="el" href="streamer__element__properties_8h.html" title="Header for streamer element properties.">streamer_element_properties.h</a></code>. See the example of setting property value in the following piece of code from <code>app_streamer.c</code>:</p>
<div class="fragment"><div class="line"><a class="code" href="structELEMENT__PROPERTY__T.html">ELEMENT_PROPERTY_T</a> prop;</div>
<div class="line">eap_args.preset_num          = *eap_par;</div>
<div class="line">POST_PROCESS_DESC_T eap_proc = {EAP_Initialize_func, EAP_Execute_func, EAP_Deinit_func, &amp;eap_args, 0};</div>
<div class="line"> </div>
<div class="line">prop.prop = PROP_AUDIOSINK_ADD_POST_PROCESS;</div>
<div class="line">prop.val  = (uintptr_t)&amp;eap_proc;</div>
<div class="line"> </div>
<div class="line">streamer_set_property(handle-&gt;streamer, prop, <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">prop.prop = PROP_FILESRC_SET_CHUNK_SIZE;</div>
<div class="line">prop.val  = 960;</div>
<div class="line"> </div>
<div class="line">streamer_set_property(handle-&gt;streamer, prop, <span class="keyword">true</span>);</div>
<div class="ttc" id="astructELEMENT__PROPERTY__T_html"><div class="ttname"><a href="structELEMENT__PROPERTY__T.html">ELEMENT_PROPERTY_T</a></div><div class="ttdoc">Element Property structure.</div><div class="ttdef"><b>Definition:</b> streamer_api.h:477</div></div>
</div><!-- fragment --><p>Some of the predefined values can be found in <code><a class="el" href="streamer__api_8h.html" title="Streamer API header.">streamer_api.h</a></code>.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
record_mic</h2>
<p>Record_mic command is only supported in the maestro_demo example. The command creates pipeline described in function <code>STREAMER_mic_Create</code> in file <code>app_streamer.c</code>. The pipeline is selected with <code>STREAM_PIPELINE_PCM</code>, <code>STREAM_PIPELINE_MIC2FILE</code> or <code>STREAM_PIPELINE_VIT</code> in <code>pipeline_type</code> parameter. Depending on the command option, that may be either <code>audio</code>, <code>file</code> or <code>vit</code>. This configuration takes samples from microphone input and send it to audio sink (speaker(s) or filesystem) with optional processing in between. The elements that pipeline consists of are:</p><ul>
<li>TYPE_ELEMENT_AUDIO_SRC</li>
<li>TYPE_ELEMENT_AUDIO_SINK or TYPE_ELEMENT_FILE_SINK or TYPE_ELEMENT_VIT_SINK</li>
</ul>
<p>Other possible element types and some of the predefined values could be found in <code><a class="el" href="streamer__api_8h.html" title="Streamer API header.">streamer_api.h</a></code>.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
usb_mic</h2>
<p>Usb_mic command is only supported in the maestro_usb_mic example. The command creates pipeline described in function <code>STREAMER_mic_Create</code> in file <code>app_streamer.c</code>. The pipeline is selected with <code>STREAM_PIPELINE_PCM</code> in <code>pipeline_type</code> parameter. This configuration takes samples from microphone input and send it to audio sink (USB port). The elements that pipeline consists of are:</p><ul>
<li>TYPE_ELEMENT_AUDIO_SRC</li>
<li>TYPE_ELEMENT_AUDIO_SINK</li>
</ul>
<p>Other possible element types and some of the predefined values could be found in <code><a class="el" href="streamer__api_8h.html" title="Streamer API header.">streamer_api.h</a></code>.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
usb_speaker</h2>
<p>Usb_speaker command is only supported in the maestro_usb_speaker example. The command creates pipeline described in function <code>STREAMER_speaker_Create</code> in file <code>app_streamer.c</code>. The pipeline is selected with <code>STREAM_PIPELINE_PCM</code> in <code>pipeline_type</code> parameter. This configuration takes samples from USB port and send it to audio sink (speaker output). The elements that pipeline consists of are:</p><ul>
<li>TYPE_ELEMENT_AUDIO_SRC</li>
<li>TYPE_ELEMENT_AUDIO_SINK</li>
</ul>
<p>Other possible element types and some of the predefined values could be found in <code><a class="el" href="streamer__api_8h.html" title="Streamer API header.">streamer_api.h</a></code>.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Configuration options</h1>
<p>User can change the pipeline type when creating the streamer object. Currently tested options are: <code>STREAM_PIPELINE_PCM</code>, <code>STREAM_PIPELINE_FILESYSTEM</code>, <code>STREAM_PIPELINE_MIC2FILE</code>, <code>STREAM_PIPELINE_VIT</code> and <code>STREAM_PIPELINE_EAP</code>. There are more pipelines defined, but supporting them is planned for future.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Supported features</h1>
<p>Current version of the audio framework supports some optional features. These can be limited for some MCU cores or boards variants.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Codecs</h2>
<p>The maestro_demo can play multiple files with the <code>file</code> option (<code>STREAM_PIPELINE_FILESYSTEM</code>). The <code>opus</code> (as standalone or as a part of <code>ogg</code> encapsulation) and <code>mp3</code> codecs are supported for now. For detailed code handling this file extension please check <code>cmd.c</code> file and <code>shellFile()</code> function. Supported codecs and its option are:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Decoder   </th><th class="markdownTableHeadNone">Sample rates [kHz]   </th><th class="markdownTableHeadNone">Number of channels   </th><th class="markdownTableHeadNone">Bit depth    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MP3   </td><td class="markdownTableBodyNone">8, 16, 24, 32, 48, 11.025, 22.050, 44.1   </td><td class="markdownTableBodyNone">1, 2 (mono/stereo)   </td><td class="markdownTableBodyNone">16    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">opus   </td><td class="markdownTableBodyNone">8, 16, 24, 48   </td><td class="markdownTableBodyNone">1, 2 (mono/stereo)   </td><td class="markdownTableBodyNone">16   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md12"></a>
VIT</h2>
<p>VIT can be enabled for the <code>record_mic</code> command using the <code>vit</code> option. In the <code>STREAMER_mic_Create</code> function in the <code>app_streamer.c</code> file, the <code>VIT_PROC</code> definition ensures the creation of pipeline with VIT (<code>STREAM_PIPELINE_VIT</code>). More details about VIT are available in the VIT package, which is located in <code>middleware\vit\{Cortex_M7, HIFI4}\Doc\</code>(depending on the platform).</p>
<h2><a class="anchor" id="autotoc_md13"></a>
EAP</h2>
<p>EAP can be enabled for the <code>file</code> command using the <code>eap</code> option. In the <code>STREAMER_file_Create</code> function in the <code>app_streamer.c</code> file, the <code>EAP_PROC</code> definition ensures the creation of pipeline with EAP (<code>STREAMER_PIPELINE_EAP</code>). More details about EAP are available in the EAP package, which is located in <code>middleware\EAP\Doc\</code>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul class="foot">
    <li class="footer">&copy; 2020 NXP Semiconductors. All rights reserved.
    </li>
  </ul>
</div>
</body>
</html>
