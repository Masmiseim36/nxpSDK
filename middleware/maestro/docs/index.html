<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Maestro Audio Framework: Getting started with Maestro framework</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="fs_logo.gif"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Maestro Audio Framework
   &#160;<span id="projectnumber">v 1.0</span>
   </div>
   <div id="projectbrief">NXP Semiconductors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Getting started with Maestro framework </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_middleware_maestro_doc_GettingStarted"></a></p>
<h1><a class="anchor" id="autotoc_md0"></a>
Introduction</h1>
<p>This document describes basic usage of Maestro Audio Framework. The intent of this framework is to enable chaining of basic audio processing blocks (called "elements"). These blocks then form stream processing object ("pipeline"). This pipeline can be used for multiple audio processing use cases. The processing blocks can include (but are not limited to) different audio sources (for example file or microphone), decoders or encoders, filters or effects and audio sinks.</p>
<p>Framework overview is depicted on the following picture:</p>
<p><img src="maestro.svg" alt="" style="pointer-events: none;" class="inline" title="maestro overview"/>   </p>
<h1><a class="anchor" id="autotoc_md1"></a>
Streamer setup</h1>
<p>In order to setup the audio framework properly, it is necessary to create a streamer with <code>streamer_create</code> api. It is also essential to setup the desired hardware peripherals using the functions described in <code><a class="el" href="streamer__pcm_8h.html" title="Streamer PCM API header.">streamer_pcm.h</a></code>. One can refer to the maestro_demo example application which can be found in audio_examples folder of the desired board. The demo application is based on FreeRTOS and uses multiple tasks to form application functionality. The Maestro example project consists of several files with reference to audio framework. The initial file is <code>main.c</code> with code to create multiple tasks. For features including SD card (read file from SD card supported for now), the <code>APP_SDCARD_Task</code> is created. The command prompt and connected functionalities are handled by <code>APP_Shell_Task</code>. User commands are handled by functions in <code>cmd.c</code>. Three main commands are:</p>
<ul>
<li>version: prints component version</li>
<li>file: performs audio file decode and playback</li>
<li>record_mic: records MIC audio</li>
</ul>
<p>One of the most important parts of the configuration is the <code>streamer_pcm.c</code> where can be found the initialization of the hardware peripherals, input and output buffer management. For further information please see also <code><a class="el" href="streamer__pcm_8h.html" title="Streamer PCM API header.">streamer_pcm.h</a></code></p>
<p>With creation of streamer object, the message thread is also created. The message thread is placed in <code>app_streamer.c</code> file, reads message queue and reacts on following messages:</p>
<ul>
<li>STREAM_MSG_ERROR</li>
<li>STREAM_MSG_EOS</li>
<li>STREAM_MSG_UPDATE_POSITION</li>
<li>STREAM_MSG_CLOSE_TASK</li>
</ul>
<p>The <code>STREAM_MSG_UPDATE_POSITION</code> prints info about current stream position, <code>STREAM_MSG_EOS</code> stops streamer, <code>STREAM_MSG_CLOSE_TASK</code> closes streamer thread and <code>STREAM_MSG_ERROR</code> stops streamer and closes thread.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
File command</h2>
<p>File command creates a streamer pipeline described in function <code>STREAMER_file_Create</code> in file <code>app_streamer.c</code>. The crucial part in this is defining pipeline type as <code>STREAM_PIPELINE_FILESYSTEM</code>. This sets up the processing chain from file source to audio sink with decoder and potentially other processing in between. Playback itself is started in <code>STREAMER_Start</code> function. The elements that pipeline consists of are:</p>
<ul>
<li>TYPE_ELEMENT_FILE_SRC</li>
<li>TYPE_ELEMENT_DECODER</li>
<li>TYPE_ELEMENT_AUDIO_SINK</li>
</ul>
<p>Other possible element types could be found in <code><a class="el" href="streamer__api_8h.html" title="Streamer API header.">streamer_api.h</a></code>.</p>
<p>Each of the elements have several properties that can be accessed using <code>streamer_get_property</code>. These properties allow user to change the values of the appropriate elements. The list of properties can be found in <code><a class="el" href="streamer__element__properties_8h.html" title="Header for streamer element properties.">streamer_element_properties.h</a></code>. For the example of setting property value one can see piece of code from <code>app_streamer.c</code>:</p>
<div class="fragment"><div class="line"><a class="code" href="structELEMENT__PROPERTY__T.html">ELEMENT_PROPERTY_T</a> prop;</div>
<div class="line">eap_args.preset_num          = *eap_par;</div>
<div class="line"><a class="code" href="structPOST__PROCESS__DESC__T.html">POST_PROCESS_DESC_T</a> eap_proc = {EAP_Initialize_func, EAP_Execute_func, EAP_Deinit_func, &amp;eap_args, 0};</div>
<div class="line"> </div>
<div class="line">prop.prop = PROP_AUDIOSINK_ADD_POST_PROCESS;</div>
<div class="line">prop.val  = (uintptr_t)&amp;eap_proc;</div>
<div class="line"> </div>
<div class="line">streamer_set_property(handle-&gt;streamer, prop, <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">prop.prop = PROP_FILESRC_SET_CHUNK_SIZE;</div>
<div class="line">prop.val  = 960;</div>
<div class="line"> </div>
<div class="line">streamer_set_property(handle-&gt;streamer, prop, <span class="keyword">true</span>);</div>
</div><!-- fragment --><p>Some of the predefined values can be found in <code><a class="el" href="streamer__api_8h.html" title="Streamer API header.">streamer_api.h</a></code>.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Record_mic command</h2>
<p>Record_mic option creates pipeline described in function <code>STREAMER_mic_Create</code> in file <code>app_streamer.c</code>. The pipeline is selected with <code>STREAM_PIPELINE_PCM</code> in <code>pipeline_type</code> parameter. This configuration takes samples from microphone input and send it to audio sink with optional processing in between. The elements that pipeline consists of are:</p><ul>
<li>TYPE_ELEMENT_AUDIO_SRC</li>
<li>TYPE_ELEMENT_AUDIO_SINK</li>
</ul>
<p>Other possible element types and some of the predefined values could be found in <code><a class="el" href="streamer__api_8h.html" title="Streamer API header.">streamer_api.h</a></code>.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Configuration options</h1>
<p>User can change the pipeline type when creating the streamer object. Currently tested options are: <code>STREAM_PIPELINE_FILESYSTEM</code> and <code>STREAM_PIPELINE_PCM</code>. There are more pipelines defined, but supporting them is planned for future.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Supported features</h1>
<p>Current version of the audio framework supports some optional features. These can be limited for some MCU cores or boards variants.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Codecs</h2>
<p>The demo can play multiple files with file option (<code>STREAM_PIPELINE_FILESYSTEM</code>). The <code>opus</code> (as standalone or as part of <code>ogg</code> encapsulation) and <code>mp3</code> codecs are supported for now. For detailed code handling this file extension please check <code>cmd.c</code> file and <code>shellFile()</code> function. Supported codecs and its option are:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Decoder  </th><th class="markdownTableHeadNone">Sample rates [kHz]  </th><th class="markdownTableHeadNone">Number of channels  </th><th class="markdownTableHeadNone">Bit depth   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MP3  </td><td class="markdownTableBodyNone">8, 16, 24, 32, 48, 11.025, 22.050, 44.1  </td><td class="markdownTableBodyNone">1, 2 (mono/stereo)  </td><td class="markdownTableBodyNone">16   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">opus  </td><td class="markdownTableBodyNone">8, 16, 24, 48  </td><td class="markdownTableBodyNone">1, 2 (mono/stereo)  </td><td class="markdownTableBodyNone">16   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md7"></a>
VIT</h2>
<p>For record_mic option (<code>STREAM_PIPELINE_PCM</code> pipeline type) the VIT can be enabled. In <code>app_streamer.c</code> file and <code>STREAMER_mic_Create</code> function the <code>VIT_PROC</code> definition enables postprocessing streamer property with VIT. More details about VIT are available in VIT package (depending on platform the path is <code>middleware\vit\{Cortex_M7, HIFI4}\Doc\</code>).</p>
<h2><a class="anchor" id="autotoc_md8"></a>
EAP</h2>
<p>For file option (<code>STREAMER_PIPELINE_FILESYSTEM</code> pipeline type) the EAP can be enabled. In <code>app_streamer.c</code> file and <code>STREAMER_file_Create</code> function the <code>EAP_PROC</code> definition enables postprocessing streamer property with EAP. More details about EAP are available in EAP package (<code>middleware\EAP\Doc\</code>). </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="astructPOST__PROCESS__DESC__T_html"><div class="ttname"><a href="structPOST__PROCESS__DESC__T.html">POST_PROCESS_DESC_T</a></div><div class="ttdoc">Structure for APP post process.</div><div class="ttdef"><b>Definition:</b> streamer_element_properties.h:19</div></div>
<div class="ttc" id="astructELEMENT__PROPERTY__T_html"><div class="ttname"><a href="structELEMENT__PROPERTY__T.html">ELEMENT_PROPERTY_T</a></div><div class="ttdoc">Element Property structure.</div><div class="ttdef"><b>Definition:</b> streamer_api.h:468</div></div>
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul class="foot">
    <li class="footer">&copy; 2020 NXP Semiconductors. All rights reserved.
    </li>
  </ul>
</div>
</body>
</html>
